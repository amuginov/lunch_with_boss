from aiogram import Router
from aiogram.types import Message
from aiogram.filters import Command
from aiogram import F
from db.crud import get_user_by_telegram_id
from keyboards.admin import admin_keyboard
from keyboards.manager import manager_keyboard
from keyboards.employee import employee_keyboard
from keyboards.common import registration_keyboard
from utils.common import return_to_main_menu
from db.database import SessionLocal

router = Router()

@router.message(F.text == "/start")
async def start_command(message: Message):
    telegram_id = message.from_user.id

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
    user = get_user_by_telegram_id(telegram_id)  # –ü–µ—Ä–µ–¥–∞—ë–º —Ç–æ–ª—å–∫–æ telegram_id

    if user:
        # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        if user.role == "admin":
            await message.answer(
                "üõ† –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä\n"
                "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –ø–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞!\n\n"
                "üë• –£–ø—Ä–∞–≤–ª—è–π—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏: –¥–æ–±–∞–≤–ª—è–π—Ç–µ –∏ —É–¥–∞–ª—è–π—Ç–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –∏ —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª–µ–π.\n"
                "üì® –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–π—Ç–µ –∑–∞—è–≤–∫–∏ –Ω–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é ‚Äî –æ–¥–æ–±—Ä—è–π—Ç–µ –∏–ª–∏ –æ—Ç–∫–ª–æ–Ω—è–π—Ç–µ –ø–æ —Å–≤–æ–µ–º—É —É—Å–º–æ—Ç—Ä–µ–Ω–∏—é.",
                reply_markup=admin_keyboard()
            )
        elif user.role == "manager":
            await message.answer(
                "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!\n\n"
                "üìÖ –ü–æ –∫–Ω–æ–ø–∫–µ ¬´–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Å–ª–æ—Ç¬ª –í—ã –º–æ–∂–µ—Ç–µ —É–ø—Ä–∞–≤–ª—è—Ç—å —Å–≤–æ–∏–º –æ–±–µ–¥–µ–Ω–Ω—ã–º —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ–º ‚Äî –¥–æ–±–∞–≤–ª—è—Ç—å —Å–≤–æ–±–æ–¥–Ω–æ–µ –≤—Ä–µ–º—è, –∫–æ–≥–¥–∞ –≥–æ—Ç–æ–≤—ã –≤—Å—Ç—Ä–µ—Ç–∏—Ç—å—Å—è —Å –∫–æ–ª–ª–µ–≥–∞–º–∏.\n"
                "üîç –í —Ä–∞–∑–¥–µ–ª–µ ¬´–ú–æ–∏ —Å–ª–æ—Ç—ã¬ª –í—ã —Å–º–æ–∂–µ—Ç–µ –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –∏ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —É–¥–∞–ª—è—Ç—å —Ä–∞–Ω–µ–µ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ —Å–ª–æ—Ç—ã.\n"
                "üìß –ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–ª–æ—Ç—ã –¥–ª—è –æ–±–µ–¥–∞ –±—É–¥—É—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å—Å—è –≤ –í–∞—à –∫–∞–ª–µ–Ω–¥–∞—Ä—å –ø–æ —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–π –ø–æ—á—Ç–µ.",
                reply_markup=manager_keyboard()
            )
        elif user.role == "user":
            await message.answer(
                "–†–∞–¥—ã –≤–∞—Å –≤–∏–¥–µ—Ç—å!\n\n"
                "üçΩ –ù–∞–∂–º–∏—Ç–µ ¬´–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –æ–±–µ–¥¬ª, —á—Ç–æ–±—ã –≤—ã–±—Ä–∞—Ç—å —É–¥–æ–±–Ω–æ–µ –≤—Ä–µ–º—è –¥–ª—è –≤—Å—Ç—Ä–µ—á–∏ —Å —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª–µ–º.\n"
                "üìã –í —Ä–∞–∑–¥–µ–ª–µ ¬´–ú–æ–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è¬ª –í—ã –º–æ–∂–µ—Ç–µ –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –∏ —É–ø—Ä–∞–≤–ª—è—Ç—å —Å–≤–æ–∏–º–∏ –æ–±–µ–¥–∞–º–∏.\n"
                "üìß –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ø—Ä–∏–¥—É—Ç –≤ –í–∞—à –∫–∞–ª–µ–Ω–¥–∞—Ä—å –ø–æ —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–π –ø–æ—á—Ç–µ.",
                reply_markup=employee_keyboard()
            )
    else:
        # –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –¥–ª—è –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        await message.answer(
            "üö´ –ù–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å\n"
            "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ!\n\n"
            "–≠—Ç–æ—Ç –±–æ—Ç –ø–æ–º–æ–≥–∞–µ—Ç –ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å —Å–æ–≤–º–µ—Å—Ç–Ω—ã–µ –æ–±–µ–¥—ã –º–µ–∂–¥—É —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—è–º–∏ –∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º–∏.\n"
            "üîê –ß—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å ‚Äî –ø—Ä–æ–π–¥–∏—Ç–µ –ø—Ä–æ—Å—Ç—É—é —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é, –Ω–∞–∂–∞–≤ –∫–Ω–æ–ø–∫—É ¬´–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è¬ª.",
            reply_markup=registration_keyboard()
        )

@router.message(Command(commands=["myid"]))
async def my_id_command(message: Message):
    await message.answer(f"–í–∞—à Telegram ID: {message.from_user.id}")